<section class="game-section">
  <div class="section-header">
    <h2 class="line-title">NOS FORMATIONS EN TENDANCE</h2>
    <div class="section-controls">
      <button
        class="control-btn prev-btn"
        (click)="prevFormation()"
        [disabled]="loading"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M15 18L9 12L15 6"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>
      <button
        class="control-btn next-btn"
        (click)="nextFormation()"
        [disabled]="loading"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M9 6L15 12L9 18"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>
    </div>
  </div>

  <div class="carousel-container" #carouselContainer>
    <div *ngIf="loading" class="loading-container">
      <div class="loader"></div>
      <p>Chargement des formations...</p>
    </div>

    <div *ngIf="errorMessage" class="error-message">
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
        <path
          d="M12 8V12"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
        />
        <circle cx="12" cy="16" r="1" fill="currentColor" />
      </svg>
      <p>{{ errorMessage }}</p>
    </div>

    <div
      class="carousel-wrapper"
      #carouselWrapper
      *ngIf="!loading && formations.length > 0"
    >
      <div
        *ngFor="let item of formations"
        class="item"
        [ngClass]="{ active: item.active }"
        [style.backgroundImage]="'url(' + item.imageUrl + ')'"
        [attr.data-id]="item.id"
        (click)="toggleActive(item)"
      >
        <span class="item-badge" [ngClass]="item.etat.toLowerCase()">{{
          item.etat
        }}</span>
        <div class="item-desc">
          <h4>{{ item.title }}</h4>
          <p>{{ item.description }}</p>
          <div class="item-meta">
            <div class="meta-item">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 8V12L15 15"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
                <circle
                  cx="12"
                  cy="12"
                  r="9"
                  stroke="currentColor"
                  stroke-width="2"
                />
              </svg>
              <span>{{ item.duree }} semaines</span>
            </div>
            <div class="meta-item">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M20 7H4C2.89543 7 2 7.89543 2 9V19C2 20.1046 2.89543 21 4 21H20C21.1046 21 22 20.1046 22 19V9C22 7.89543 21.1046 7 20 7Z"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <path
                  d="M16 7V4C16 2.89543 15.1046 2 14 2H10C8.89543 2 8 2.89543 8 4V7"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <path
                  d="M12 12L12 16"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                />
                <path
                  d="M12 12L16 12"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                />
              </svg>
              <span>{{ item.niveau }}</span>
            </div>
            <div class="meta-item">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M12 15C15.3137 15 18 12.3137 18 9C18 5.68629 15.3137 3 12 3C8.68629 3 6 5.68629 6 9C6 12.3137 8.68629 15 12 15Z"
                  stroke="currentColor"
                  stroke-width="2"
                />
                <path
                  d="M3 21C3.95728 17.9237 7.41998 16 12 16C16.58 16 20.0427 17.9237 21 21"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                />
              </svg>
              <span>{{ item.nomFormateur }}</span>
            </div>
          </div>
          <button class="enroll-btn">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M16 3H21V8"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M4 20L21 3"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M21 16V21H16"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M15 15L21 21"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M4 4L9 9"
                stroke="white"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            S'inscrire - {{ item.prix }} €
          </button>
        </div>
      </div>
    </div>

    <div
      *ngIf="!loading && formations.length === 0 && !errorMessage"
      class="empty-state"
    >
      <svg
        width="48"
        height="48"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M3 7V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17V9C21 7.89543 20.1046 7 19 7H13L11 5H5C3.89543 5 3 5.89543 3 7Z"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <h3>Aucune formation disponible</h3>
      <p>
        Il n'y a actuellement aucune formation disponible dans notre catalogue.
      </p>
      <button class="refresh-btn" (click)="loadFormations()">Rafraîchir</button>
    </div>
  </div>
</section>
